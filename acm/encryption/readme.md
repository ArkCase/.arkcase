# Introduction
The implemented encryption of a plaintext in ArkCase is done in two steps. First, encrypt the plaintext with a symmetric key (a plain old password, in core branch it is **AcMd3v$**).
Then, encrypt the symmetric key using a public key. To decrypt, first decrypt the encrypted symmetric key with the corresponding private key, then decrypt the plaintext with the symmetric key.

# Encrypt a plaintext (property value) with the symmetric key

To encrypt a plaintext create a file **plaintextFile** containing the plaintext to encrypt. Run the following command:
```
openssl enc -aes-256-cbc -a -v -in plaintextFile -out plaintextFile.encrypted -p
```
Use the symmetric key as passphrase (in core branch it is **AcMd3v$**)

# Use the encrypted plaintext in a property file

Copy the encrypted plaintext value from the **plainText.encrypted** file from above and paste it as a property value enclosed in **ENC(encryptedValue)**.

For example the property value **arkcase** in *datasource.Properties* file:
```
acm.password=arkcase
```
would become:
```
acm.password=ENC(U2FsdGVkX1+S/7ACJMKSCan/lNJdUeVKbBXy3/v0Dss=)
```

# Using your own private key and symmetric key
If you want to use your own private key instead of the default one **_<user.home>/.arkcase/acm/encryption/arkcase-priv.der_**, you will also need to generate the encrypted symmetric key located in this directory.

### The private key
The private key used must be placed in **_<user.home>/.arkcase/acm/encryption/arkcase-priv.der_**.

The private key must be 2048 bit RSA key pair.

For example the command used to create the existing *arkcase-priv.der* with an intermediate certificate authority (CA) key:
```
openssl genrsa -aes256 -out intermediate/private/intermediateCA.key.pem 2048
```
*Note: In production the private key file must be accessible only to the user account that runs the ArkCase process.*

### The encrypted symmetric key
The encrypted symmetric key must be placed in **_<user.home>/.arkcase/acm/encryption/symmetricKey.encrypted_**.

The encrypted symmetric key is generated by encrypting the symmetric key (a plain old password) with the public key.
For example to create the encrypted symmetric key file, create a **symmetricKeyFile** containing the symmetric key (a plain old password) and run the following command:
```
openssl rsautl -encrypt -pubin -inkey arkcase-pub.pem -in symmetricKeyFile -out message.encrypted
```

## Known properties files containing passwords/passphrases

- datasource.properties (two properties)
- acmEmailReceiver.properties
- acm-forms.properties
- acm-reports-server-config.properties
- alfrescoRmaPlugin.properties
- cmis.properties
- msOutlookIntegration.properties
- msOutlookPlugin.properties
- notification.properties
- spring-config-XXX-ldap.properties (should be generated through admin automatically)