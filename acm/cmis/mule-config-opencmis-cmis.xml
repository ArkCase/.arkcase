<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:cmis="http://www.mulesoft.org/schema/mule/cmis"
      xmlns:spring="http://www.springframework.org/schema/beans"
      xsi:schemaLocation="
               http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
               http://www.mulesoft.org/schema/mule/cmis http://www.mulesoft.org/schema/mule/cmis/current/mule-cmis.xsd
               http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd">

    <spring:beans>
        <spring:bean class="com.armedia.acm.crypto.properties.AcmEncryptablePropertySourcesPlaceholderConfigurer">
            <spring:property name="encryptablePropertyUtils" ref="acmEncryptablePropertyUtils"/>
            <spring:property name="location" value="file:${user.home}/.arkcase/acm/cmis/mule-config-opencmis-cmis.properties"/>
            <spring:property name="placeholderPrefix" value="${opencmis."/>
        </spring:bean>

        <!-- register this configuration -->
        <spring:bean class="org.springframework.beans.factory.config.MethodInvokingBean">
            <spring:property name="targetObject" ref="cmisConfigRegistry"/>
            <spring:property name="targetMethod" value="registerCmisConfig"/>
            <spring:property name="arguments">
                <spring:list>
                    <spring:value>${opencmis.cmis.id}</spring:value>
                    <spring:value>${opencmis.cmis.cmisVersioningState}</spring:value>
                    <!-- put here additional parameters not used in <cmis:config/> section below -->
                </spring:list>
            </spring:property>
        </spring:bean>
    </spring:beans>

    <cmis:config
            name="opencmis"
            baseUrl="${opencmis.cmis.baseUrl}"
            username="${opencmis.cmis.username}"
            password="${opencmis.cmis.password}"
            useAlfrescoExtension="${opencmis.cmis.useAlfrescoExtension}"
            endpoint="${opencmis.cmis.endpoint}"
            repositoryId="#{ '${opencmis.cmis.repositoryId}' == '' ? null : '${opencmis.cmis.repositoryId}' }">
        <!-- for Alfresco we don't need a repository ID, so if the property is empty, use null instead... that is what
        the above expression does. Documentum does need a repository ID. -->

        <!-- somehow we can't use a property for exhausted action. -->
        <cmis:connection-pooling-profile
                maxActive="${opencmis.cmis.maxActive}"
                maxIdle="${opencmis.cmis.maxIdle}"
                exhaustedAction="WHEN_EXHAUSTED_GROW"
                maxWait="${opencmis.cmis.maxWait}"
                minEvictionMillis="${opencmis.cmis.minEvictionMillis}"
                evictionCheckIntervalMillis="${opencmis.cmis.evictionCheckIntervalMillis}"/>
        <reconnect count="${opencmis.cmis.reconnectCount}" frequency="${opencmis.cmis.reconnectFrequency}"/>

    </cmis:config>
</mule>
